from twilio.rest import Client
import json

# --- –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø TWILIO (–ó–∞–º–µ–Ω–∏—Ç–µ —Å–≤–æ–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏) ---
ACCOUNT_SID = 'ACxxxxxxxxxxxxxxxxxxxxxxxxxxxxx' # –í–∞—à SID –∞–∫–∫–∞—É–Ω—Ç–∞
AUTH_TOKEN = 'your_auth_token'                 # –í–∞—à —Ç–æ–∫–µ–Ω –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
TWILIO_PHONE_NUMBER = '+15017122661'           # –í–∞—à –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ Twilio
# ----------------------------------------------------

# –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤ (–ª–∏–¥–æ–≤)
LEAD_DATABASE = [
    {"name": "–ò–≤–∞–Ω–æ–≤ –ü—ë—Ç—Ä", "phone": "+79001234567", "product": "Premium Banking"},
    {"name": "–°–º–∏—Ä–Ω–æ–≤–∞ –ï–ª–µ–Ω–∞", "phone": "+79009876543", "product": "Business Credit"},
    {"name": "–ö–æ–∑–ª–æ–≤ –°–µ—Ä–≥–µ–π", "phone": "+79001112233", "product": "Mortgage"}
]

def make_automated_calls(leads):
    """–ò–Ω–∏—Ü–∏–∏—Ä—É–µ—Ç –∑–≤–æ–Ω–æ–∫ –∫–∞–∂–¥–æ–º—É –ª–∏–¥—É –≤ —Å–ø–∏—Å–∫–µ."""
    
    try:
        client = Client(ACCOUNT_SID, AUTH_TOKEN)
        
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ Twilio –∫–ª–∏–µ–Ω—Ç–∞: {e}")
        return

    print("--- –ó–∞–ø—É—Å–∫ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –Ω–∞–±–æ—Ä–∞ –Ω–æ–º–µ—Ä–∞ ---")

    for lead in leads:
        to_number = lead["phone"]
        
        try:
            # Twilio —Ç—Ä–µ–±—É–µ—Ç URL, —á—Ç–æ–±—ã –∑–Ω–∞—Ç—å, —á—Ç–æ –≥–æ–≤–æ—Ä–∏—Ç—å –∏–ª–∏ –∫—É–¥–∞ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–∏—Ç—å –∑–≤–æ–Ω–æ–∫.
            # –ó–¥–µ—Å—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è TwiML Bin, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–æ–∏–≥—Ä—ã–≤–∞–µ—Ç –≥–æ–ª–æ—Å–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ.
            call = client.calls.create(
                to=to_number,
                from_=TWILIO_PHONE_NUMBER,
                url='http://demo.twilio.com/docs/voice.xml' # URL, –∫–æ—Ç–æ—Ä—ã–π Twilio –≤—ã–∑—ã–≤–∞–µ—Ç –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π
            )

            print(f"üìû –ó–≤–æ–Ω–æ–∫ –∏–Ω–∏—Ü–∏–∏—Ä–æ–≤–∞–Ω: {lead['name']} ({to_number}). SID –∑–≤–æ–Ω–∫–∞: {call.sid}")
            
            # –í —Ä–µ–∞–ª—å–Ω–æ–π —Å–∏—Å—Ç–µ–º–µ –∑–¥–µ—Å—å –±—ã –ø–µ—Ä–µ–¥–∞–≤–∞–ª—Å—è SID –∑–≤–æ–Ω–∫–∞ 
            # –≤ CRM –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∂–∏–≤—ã–º –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–º.

        except Exception as e:
            print(f"‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–∑–≤–æ–Ω–∏—Ç—å {lead['name']}: {e}")

    print("--- –ù–∞–±–æ—Ä –∑–∞–≤–µ—Ä—à–µ–Ω ---")

# if __name__ == "__main__":
#     make_automated_calls(LEAD_DATABASE)
